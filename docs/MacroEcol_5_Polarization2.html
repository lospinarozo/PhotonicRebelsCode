<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Polarisation PGLS</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Shady Xmas Beetles</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="MacroEcol_1_SettingUp.html">Setting up</a>
</li>
<li>
  <a href="MacroEcol_2_OpticalProperties.html">Optical properties</a>
</li>
<li>
  <a href="MacroEcol_3_EcologicalVariables.html">Ecological variables</a>
</li>
<li>
  <a href="MacroEcol_5_Polarization.html">Polarisation</a>
</li>
<li>
  <a href="MacroEcol_5_Polarization2.html">Polarisation PGLS</a>
</li>
<li>
  <a href="MacroEcol_6_ManuscriptStats.html">Reflectivity PGLS</a>
</li>
<li>
  <a href="MacroEcol_7_Summary.html">Summary</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Polarisation PGLS</h1>

</div>


<p>In this script we study the Polarization trait corrected by
phylogeny.</p>
<div id="setting-up" class="section level1">
<h1>Setting up</h1>
<p>Libraries sourced from an additional script</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;./MacroEcol_1_Libraries.R&quot;</span>)</span></code></pre></div>
<p>We imported the data obtained from previous steps.</p>
<p>We first aggregated the polarization and environment data to get one
value per species for each variable</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>RPDataAgg <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;../Data/FromCode/PolarzElytraRefl.csv&quot;</span>)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(RPDataAgg)</span></code></pre></div>
<pre><code>##      ind    R_ALL     R_VIS    R_NIR        Res   size         phylogeny_name
## 1 abno01 24.36959 15.194950 32.37499 -9.8258343 1.5390 Anoplognathus_abnormis
## 2 abno02 30.17203 17.865117 40.90967 -3.9177421 1.6120 Anoplognathus_abnormis
## 3 anom01 17.25955  2.229028 30.33292  0.8864166 1.7630        Anomala_antigua
## 4 anom02 19.93132  7.888188 30.40910 -4.6042095 1.7675        Anomala_antigua
## 5 atki01 15.52166  6.194366 23.61734 -9.7297912 2.4590   Calloodes_atkinsonii
## 6 atki02 18.73437  6.636925 29.23785 -4.5446134 2.0180   Calloodes_atkinsonii
##          PC1         PC2  spp   ElytrPol
## 1 -2.1441633  0.07156382 abno 0.05631758
## 2 -1.8227362  0.16083346 abno 0.07228979
## 3 -2.3016135 -2.27652672 anom 0.13646753
## 4 -0.3855034 -1.15167811 anom 0.18547191
## 5 -2.7414058  1.08031739 atki 0.30583122
## 6 -2.7414058  1.08031739 atki 0.30355419</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>RPDAgg1 <span class="ot">&lt;-</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  RPDataAgg <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>ind, <span class="sc">-</span>spp) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(phylogeny_name, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(phylogeny_name) <span class="sc">%&gt;%</span> <span class="co"># group</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="fu">list</span>(mean))) <span class="co"># mean</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a data frame for the comparative.data function</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>RPDAgg1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(RPDAgg1)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(RPDAgg1)</span></code></pre></div>
<pre><code>##              phylogeny_name  R_ALL_1   R_VIS_1  R_NIR_1       Res_1  size_1
## 1           Anomala_antigua 18.59543  5.058608 30.37101  -1.8588965 1.76525
## 2    Anoplognathus_abnormis 27.27081 16.530033 36.64233  -6.8717882 1.57550
## 3      Anoplognathus_aeneus 22.10221 10.404140 32.27222  -5.2159832 3.11250
## 4      Anoplognathus_aureus 42.63349 34.727230 49.54375 -11.8705985 1.71400
## 5 Anoplognathus_boisduvalii 31.14445 17.303047 43.21203  -1.0624889 2.60540
## 6 Anoplognathus_brevicollis 27.43900 12.869292 40.14934   0.2362219 2.51400
##       PC1_1      PC2_1 ElytrPol_1
## 1 -1.343558 -1.7141024 0.16096972
## 2 -1.983450  0.1161986 0.06430368
## 3 -1.903878  0.4191886 0.11204259
## 4 -3.493997 -0.4335432 0.20560559
## 5 -1.635325 -0.9220386 0.08846901
## 6 -1.145208 -3.6269193 0.08712699</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(RPDAgg1) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;phylogeny_name&quot;</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;TOT&quot;</span>, <span class="st">&quot;VIS&quot;</span>, <span class="st">&quot;NIR&quot;</span>, <span class="st">&quot;Res&quot;</span>, <span class="st">&quot;size&quot;</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>, <span class="st">&quot;Pol&quot;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify to make it compatible with tree tips</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>RPDAgg <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(RPDAgg1) <span class="co"># create new data frame</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(RPDAgg) <span class="ot">&lt;-</span> RPDAgg[, <span class="dv">1</span>] <span class="co"># make species the row names</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>RPDAgg <span class="ot">&lt;-</span> RPDAgg[, <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(RPDAgg)] <span class="co"># eliminate spp name (redundant)</span></span></code></pre></div>
<p>We separated it into different data frames which is useful for
plotting</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(RPDAgg) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;TOT&quot;</span>, <span class="st">&quot;VIS&quot;</span>, <span class="st">&quot;NIR&quot;</span>, <span class="st">&quot;Res&quot;</span>, <span class="st">&quot;size&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>, <span class="st">&quot;Pol&quot;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>TOTdf <span class="ot">&lt;-</span> RPDAgg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(TOT)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>VISdf <span class="ot">&lt;-</span> RPDAgg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(VIS)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>NIRdf <span class="ot">&lt;-</span> RPDAgg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(NIR)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>Resdf <span class="ot">&lt;-</span> RPDAgg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Res)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>PC1df <span class="ot">&lt;-</span> RPDAgg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(PC1)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>PC2df <span class="ot">&lt;-</span> RPDAgg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(PC2)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>Sizdf <span class="ot">&lt;-</span> RPDAgg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(size)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>Poldf <span class="ot">&lt;-</span> RPDAgg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Pol)</span></code></pre></div>
<p>And we imported the phylogeny from a .nwk file which contains 2000
phylogenetic trees. This allows us to test our hypothesis in multiple
trees and not only on the MCC tree. This way, we account for any
uncertainty in unresolved tips of our phylogeny.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Phylogeny</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">&lt;-</span> ape<span class="sc">::</span><span class="fu">read.tree</span>(<span class="st">&quot;../Data/XMAS_mat2b_bst2ef_set23nn2_pinct.nwk&quot;</span>)</span></code></pre></div>
<p>We created the subsets we need to test our hypothesis</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>PDVIS <span class="ot">&lt;-</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  RPDAgg <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>TOT, <span class="sc">-</span>NIR, <span class="sc">-</span>Res) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;Reflectance&quot;</span> <span class="ot">=</span> VIS) <span class="co"># keep only visible reflectivity</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>PDPol <span class="ot">&lt;-</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  RPDAgg <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>TOT, <span class="sc">-</span>NIR, <span class="sc">-</span>Res, <span class="sc">-</span>VIS) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;Polarization&quot;</span> <span class="ot">=</span> Pol) <span class="co"># keep only polarization</span></span></code></pre></div>
</div>
<div id="plot-in-tree" class="section level1">
<h1>Plot in Tree</h1>
<p><span style="color: #04C799"> <strong>Question</strong> </span>
<br/></p>
<p>Chiral structures are supposed to be well conserved within scarabs.
Thus, abscense or low polarization should be unusual and perhaps
clustered in only a few branches of the phylogenetic tree.</p>
<p><strong>Does the degree of polarization cluster according to
phylogeny?</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read the tree</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>MCCtree.raw <span class="ot">&lt;-</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  ape<span class="sc">::</span><span class="fu">read.nexus</span>(<span class="st">&quot;../Data/xmas_mat2b_bst2ef_set23nn2_pinct_med.tre&quot;</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune extra spp in the tree, not contain in the test sample</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>species.MCC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">unique</span>(RPDataAgg<span class="sc">$</span>phylogeny_name))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to &quot;row names&quot; (required for following steps)</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(species.MCC) <span class="ot">&lt;-</span> species.MCC[, <span class="dv">1</span>]</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure the names in data set and tree match</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>temp.MCC <span class="ot">&lt;-</span> <span class="fu">name.check</span>(MCCtree.raw, species.MCC)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># This step would be neccesary if the tips had been different.</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co"># MCCtree &lt;- drop.tip(MCCtree.raw, temp.MCC$tree_not_data)</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Instead, changed the name</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>MCCtree <span class="ot">&lt;-</span> MCCtree.raw</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># create phylogeny object for ggtree()</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>phylo.MCC <span class="ot">&lt;-</span> <span class="fu">ggtree</span>(MCCtree, <span class="at">layout =</span> <span class="st">&quot;rectangular&quot;</span>) <span class="sc">+</span> <span class="fu">geom_tiplab</span>(<span class="at">size =</span> <span class="fl">1.5</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co"># set xlim</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>phylo.MCC <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_nodepoint</span>(<span class="at">col =</span> <span class="st">&quot;gold&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>)</span></code></pre></div>
<p><img src="MacroEcol_5_Polarization2_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Plot the traits on the tree</p>
<p>The values that we include in this plot has to be the average between
individuals, since there is only one branch per species.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a MCC tree without tip names for the plot</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>tree_only <span class="ot">&lt;-</span> <span class="fu">ggtree</span>(MCCtree, <span class="at">layout =</span> <span class="st">&quot;rectangular&quot;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create heat map columns</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: log transforms increase contrast for visualization purposes</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Polariz</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fu">gheatmap</span>(tree_only, Poldf,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">low =</span> <span class="st">&quot;gray90&quot;</span>, <span class="at">high =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">font.size =</span> <span class="dv">2</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames_position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">colnames_angle =</span> <span class="dv">0</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames_offset_x =</span> <span class="dv">0</span>, <span class="at">colnames_offset_y =</span> <span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend_title =</span> <span class="st">&quot;Pol&quot;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Reflectance</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># VIS</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>p3.scale <span class="ot">&lt;-</span> p0 <span class="sc">+</span> <span class="fu">new_scale_fill</span>() <span class="co"># add new scale for second variable</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">gheatmap</span>(p3.scale, <span class="fu">log</span>(VISdf),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="fl">1.5</span>, <span class="co"># to avoid overlapping with p1</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">low =</span> <span class="st">&quot;#1b9e77&quot;</span>, <span class="at">high =</span> <span class="st">&quot;#FFFFBF&quot;</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">font.size =</span> <span class="dv">2</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames_position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">colnames_angle =</span> <span class="dv">0</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames_offset_x =</span> <span class="dv">0</span>, <span class="at">colnames_offset_y =</span> <span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend_title =</span> <span class="st">&quot;VIS&quot;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># NIR</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>p4.scale <span class="ot">&lt;-</span> p3 <span class="sc">+</span> <span class="fu">new_scale_fill</span>() <span class="co"># add new scale for second variable</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">gheatmap</span>(p4.scale,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    NIRdf <span class="sc">+</span> <span class="co"># get log to bring them closer to each other</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">abs</span>((<span class="fu">min</span>(NIRdf))) <span class="sc">+</span> <span class="dv">1</span>) <span class="co"># make them all positive</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  ), <span class="co"># this correction allows better visualization</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="dv">3</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">low =</span> <span class="st">&quot;#88419d&quot;</span>, <span class="at">high =</span> <span class="st">&quot;#edf8fb&quot;</span>,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">font.size =</span> <span class="dv">2</span>,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames_position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">colnames_angle =</span> <span class="dv">0</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames_offset_x =</span> <span class="dv">0</span>, <span class="at">colnames_offset_y =</span> <span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend_title =</span> <span class="st">&quot;NIR&quot;</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>p4</span></code></pre></div>
</div>
<div id="questions" class="section level1">
<h1>Questions</h1>
<div id="phylogeny" class="section level2">
<h2>Phylogeny</h2>
<p><span style="color: #04C799"> <strong>Question</strong> </span>
<br/></p>
<p><strong>Do visible reflectivity and polarization evolve
separately?</strong></p>
<p>If the two evolve together their correlation should dissapear when
after applying the phylogenetic correction and the phylogenetic signal
in these traits would be high</p>
<p><span style="color: #04C799"> <strong>Tests</strong> </span>
<br/></p>
<div id="mcc-tree" class="section level3">
<h3>MCC tree</h3>
<div id="vis-pgls-in-the-mcc" class="section level4">
<h4>VIS PGLS in the MCC</h4>
<p>Create the data frame of comparative data</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>comp_data <span class="ot">&lt;-</span> <span class="fu">comparative.data</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">phy =</span> MCCtree,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> RPDAgg1, <span class="co"># aggregated data without the spp in the row names</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names.col =</span> <span class="st">&quot;phylogeny_name&quot;</span>, <span class="co"># contains the column phylogeny name</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">vcv =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.omit =</span> <span class="cn">FALSE</span>, <span class="at">warn.dropped =</span> <span class="cn">TRUE</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Establish the model</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pglsPDVIS <span class="ot">&lt;-</span> <span class="fu">pgls</span>(VIS <span class="sc">~</span> Pol,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> comp_data, <span class="at">param.CI =</span> <span class="fl">0.95</span>, <span class="at">lambda =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pglsPDVIS)</span></code></pre></div>
<pre><code>## 
## Call:
## pgls(formula = VIS ~ Pol, data = comp_data, lambda = &quot;ML&quot;, param.CI = 0.95)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.3094 -2.0179 -0.5717  0.6327  4.3905 
## 
## Branch length transformations:
## 
## kappa  [Fix]  : 1.000
## lambda [ ML]  : 0.774
##    lower bound : 0.000, p = 1    
##    upper bound : 1.000, p = 0.050469
##    95.0% CI   : (NA, NA)
## delta  [Fix]  : 1.000
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)  12.5980     5.3203  2.3679  0.02224 *
## Pol           7.7967     9.4632  0.8239  0.41434  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.29 on 45 degrees of freedom
## Multiple R-squared: 0.01486, Adjusted R-squared: -0.007031 
## F-statistic: 0.6788 on 1 and 45 DF,  p-value: 0.4143</code></pre>
<p>Test phylogenetic signal using Pagel’s lambda:</p>
<p>Phylogenetic signal is high in VIS reflectivity.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>pagelPDVIS <span class="ot">&lt;-</span> PDVIS<span class="sc">$</span>Reflectance <span class="co"># Define which trait you want to test</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pagelPDVIS) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(PDVIS) <span class="co"># Row names = tree tips</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">phylosig</span>(MCCtree, pagelPDVIS, <span class="at">method =</span> <span class="st">&quot;lambda&quot;</span>, <span class="at">test =</span> <span class="cn">TRUE</span>, <span class="at">nsim =</span> <span class="dv">999</span>)</span></code></pre></div>
<pre><code>## 
## Phylogenetic signal lambda : 0.823323 
## logL(lambda) : -158.392 
## LR(lambda=0) : 0.765898 
## P-value (based on LR test) : 0.381489</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nsim = 999 means testing with 999 randomizations</span></span></code></pre></div>
<p>Phylogenetic signal is high for Polarization.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>pagelPDPol <span class="ot">&lt;-</span> PDVIS<span class="sc">$</span>Pol <span class="co"># Define which trait you want to test</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pagelPDPol) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(PDVIS) <span class="co"># Row names = tree tips</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">phylosig</span>(MCCtree, pagelPDPol, <span class="at">method =</span> <span class="st">&quot;lambda&quot;</span>, <span class="at">test =</span> <span class="cn">TRUE</span>, <span class="at">nsim =</span> <span class="dv">999</span>)</span></code></pre></div>
<pre><code>## 
## Phylogenetic signal lambda : 0.955169 
## logL(lambda) : 40.0202 
## LR(lambda=0) : 28.1436 
## P-value (based on LR test) : 0.000000112637</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nsim = 999 means testing with 999 randomizations</span></span></code></pre></div>
<p><span style="color: #04C799"> <strong>Conclusion</strong> </span>
<br/></p>
<p><strong>High visible reflectivity and polarization did not evolve
independently. They do cluster according to phylogeny.</strong></p>
<p><br> <br> <br></p>
</div>
<div id="nir-pgls-in-the-mcc" class="section level4">
<h4>NIR PGLS in the MCC</h4>
<p>The data frame of comparative data is the same as for visible
light</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>pglsPDNIR <span class="ot">&lt;-</span> <span class="fu">pgls</span>(NIR <span class="sc">~</span> Pol,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> comp_data, <span class="at">param.CI =</span> <span class="fl">0.95</span>, <span class="at">lambda =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pglsPDNIR)</span></code></pre></div>
<pre><code>## 
## Call:
## pgls(formula = NIR ~ Pol, data = comp_data, lambda = &quot;ML&quot;, param.CI = 0.95)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -6.513 -2.119  1.230  2.693  8.576 
## 
## Branch length transformations:
## 
## kappa  [Fix]  : 1.000
## lambda [ ML]  : 0.802
##    lower bound : 0.000, p = 0.42414
##    upper bound : 1.000, p = 0.11061
##    95.0% CI   : (NA, NA)
## delta  [Fix]  : 1.000
## 
## Coefficients:
##             Estimate Std. Error t value    Pr(&gt;|t|)    
## (Intercept)  46.8842     8.4462  5.5509 0.000001442 ***
## Pol         -22.6554    14.6475 -1.5467      0.1289    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.604 on 45 degrees of freedom
## Multiple R-squared: 0.05048, Adjusted R-squared: 0.02938 
## F-statistic: 2.392 on 1 and 45 DF,  p-value: 0.1289</code></pre>
<p>Test phylogenetic signal using Pagel’s lambda: Pending…</p>
</div>
<div id="vis-subset-pgls-mcc" class="section level4">
<h4>VIS subset PGLS MCC</h4>
<p>We need to subset the data frame excluding the species with composite
materials: chiral and non-chiral</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Polsubset <span class="ot">&lt;-</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  RPDAgg1 <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span> (</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    phylogeny_name <span class="sc">!=</span> <span class="st">&quot;Anoplognathus_prasinus&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    phylogeny_name <span class="sc">!=</span> <span class="st">&quot;Xylonichus_sp&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    phylogeny_name <span class="sc">!=</span> <span class="st">&quot;Paraschizognathus_ocularis&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    phylogeny_name <span class="sc">!=</span> <span class="st">&quot;Paraschizognathus_olivaceous&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    phylogeny_name <span class="sc">!=</span> <span class="st">&quot;Paraschizognathus_prasinus&quot;</span><span class="sc">&amp;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    phylogeny_name <span class="sc">!=</span> <span class="st">&quot;Anoplostethus_laetus&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    phylogeny_name <span class="sc">!=</span> <span class="st">&quot;Anoplostethus_opalinus&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    phylogeny_name <span class="sc">!=</span> <span class="st">&quot;Anoplostethus_roseus&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    phylogeny_name <span class="sc">!=</span> <span class="st">&quot;Epichrysus_lamprimoides&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    phylogeny_name <span class="sc">!=</span> <span class="st">&quot;Anoplognathus_aureus&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    phylogeny_name <span class="sc">!=</span> <span class="st">&quot;Anoplognathus_parvulus&quot;</span> </span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>Polsubset <span class="ot">&lt;-</span>  <span class="fu">as.data.frame</span>(Polsubset)</span></code></pre></div>
<p>Then trim the tree</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune extra spp in the tree, not contain in the test sample</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>species.MCCsub <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">unique</span>(Polsubset<span class="sc">$</span>phylogeny_name))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to &quot;row names&quot; (required for following steps)</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(species.MCCsub) <span class="ot">&lt;-</span> species.MCCsub[, <span class="dv">1</span>]</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure the names in data set and tree match</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>temp.MCCsub <span class="ot">&lt;-</span> <span class="fu">name.check</span>(MCCtree.raw, species.MCCsub)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>temp.MCCsub </span></code></pre></div>
<pre><code>## $tree_not_data
##  [1] &quot;Anoplognathus_aureus&quot;         &quot;Anoplognathus_parvulus&quot;      
##  [3] &quot;Anoplognathus_prasinus&quot;       &quot;Anoplostethus_laetus&quot;        
##  [5] &quot;Anoplostethus_opalinus&quot;       &quot;Anoplostethus_roseus&quot;        
##  [7] &quot;Epichrysus_lamprimoides&quot;      &quot;Paraschizognathus_ocularis&quot;  
##  [9] &quot;Paraschizognathus_olivaceous&quot; &quot;Paraschizognathus_prasinus&quot;  
## [11] &quot;Xylonichus_sp&quot;               
## 
## $data_not_tree
## character(0)</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This step would be neccesary if the tips had been different.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>MCCtreesub <span class="ot">&lt;-</span> <span class="fu">drop.tip</span>(MCCtree.raw, temp.MCCsub<span class="sc">$</span>tree_not_data)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create phylogeny object for ggtree()</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>phylo.MCC <span class="ot">&lt;-</span> <span class="fu">ggtree</span>(MCCtreesub, <span class="at">layout =</span> <span class="st">&quot;rectangular&quot;</span>) <span class="sc">+</span> <span class="fu">geom_tiplab</span>(<span class="at">size =</span> <span class="fl">1.5</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># set xlim</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>phylo.MCC <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_nodepoint</span>(<span class="at">col =</span> <span class="st">&quot;gold&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>)</span></code></pre></div>
<p><img src="MacroEcol_5_Polarization2_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Now create comparative data</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>comp_data_sub <span class="ot">&lt;-</span> <span class="fu">comparative.data</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">phy =</span> MCCtreesub,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Polsubset, <span class="co"># aggregated data without the spp in the row names</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names.col =</span> <span class="st">&quot;phylogeny_name&quot;</span>, <span class="co"># contains the column phylogeny name</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">vcv =</span> <span class="cn">TRUE</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.omit =</span> <span class="cn">FALSE</span>, <span class="at">warn.dropped =</span> <span class="cn">TRUE</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Run model</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pglsPDVISsub <span class="ot">&lt;-</span> <span class="fu">pgls</span>(VIS <span class="sc">~</span> Pol,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> comp_data_sub, <span class="at">param.CI =</span> <span class="fl">0.95</span>, <span class="at">lambda =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pglsPDVISsub)</span></code></pre></div>
<pre><code>## 
## Call:
## pgls(formula = VIS ~ Pol, data = comp_data_sub, lambda = &quot;ML&quot;, 
##     param.CI = 0.95)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.6089 -0.5845  0.5978  1.3236  2.9735 
## 
## Branch length transformations:
## 
## kappa  [Fix]  : 1.000
## lambda [ ML]  : 0.000
##    lower bound : 0.000, p = 1    
##    upper bound : 1.000, p = 0.0027462
##    95.0% CI   : (NA, 0.879)
## delta  [Fix]  : 1.000
## 
## Coefficients:
##             Estimate Std. Error t value           Pr(&gt;|t|)    
## (Intercept)  14.1864     1.2119 11.7062 0.0000000000001781 ***
## Pol         -15.0346     9.5636 -1.5721             0.1252    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.496 on 34 degrees of freedom
## Multiple R-squared: 0.06776, Adjusted R-squared: 0.04034 
## F-statistic: 2.471 on 1 and 34 DF,  p-value: 0.1252</code></pre>
</div>
<div id="nir-subset-pgls-mcc" class="section level4">
<h4>NIR subset PGLS MCC</h4>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>pglsPDNIRsub <span class="ot">&lt;-</span> <span class="fu">pgls</span>(NIR <span class="sc">~</span> Pol,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> comp_data_sub, <span class="at">param.CI =</span> <span class="fl">0.95</span>, <span class="at">lambda =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pglsPDNIRsub)</span></code></pre></div>
<pre><code>## 
## Call:
## pgls(formula = NIR ~ Pol, data = comp_data_sub, lambda = &quot;ML&quot;, 
##     param.CI = 0.95)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.3121 -1.0519  0.6397  1.9417  3.5418 
## 
## Branch length transformations:
## 
## kappa  [Fix]  : 1.000
## lambda [ ML]  : 0.000
##    lower bound : 0.000, p = 1    
##    upper bound : 1.000, p = 0.0021504
##    95.0% CI   : (NA, 0.908)
## delta  [Fix]  : 1.000
## 
## Coefficients:
##             Estimate Std. Error t value              Pr(&gt;|t|)    
## (Intercept)  40.5372     1.5749  25.739 &lt; 0.00000000000000022 ***
## Pol         -42.2945    12.4288  -3.403              0.001723 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.945 on 34 degrees of freedom
## Multiple R-squared: 0.2541,  Adjusted R-squared: 0.2321 
## F-statistic: 11.58 on 1 and 34 DF,  p-value: 0.001723</code></pre>
</div>
</div>
<div id="multiple-trees" class="section level3">
<h3>Multiple trees</h3>
<div id="vis-pgls-in-multiple-trees" class="section level4">
<h4>VIS PGLS in multiple trees</h4>
<p>Function</p>
<p>Note that the function has to be modified for the predictors and data
frame that we are using</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;6_multiple_pgls_function_A.R&quot;</span>) <span class="co"># script A is for Polarization as predictor</span></span></code></pre></div>
<p>Model</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>MuPGLSPol1 <span class="ot">&lt;-</span> Reflectance <span class="sc">~</span> Pol</span></code></pre></div>
<p>Dataset</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the phylogeny name again because in this function it is needed:</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>PDVIS2 <span class="ot">&lt;-</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  PDVIS <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">phylogeny_name =</span> <span class="fu">rownames</span>(PDVIS)) <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Reflectance, Pol)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>PDVIS2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(PDVIS2)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(PDVIS2)</span></code></pre></div>
<pre><code>##                           Reflectance        Pol
## Anomala_antigua              5.058608 0.16096972
## Anoplognathus_abnormis      16.530033 0.06430368
## Anoplognathus_aeneus        10.404140 0.11204259
## Anoplognathus_aureus        34.727230 0.20560559
## Anoplognathus_boisduvalii   17.303047 0.08846901
## Anoplognathus_brevicollis   12.869292 0.08712699</code></pre>
<p>Apply</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>runsPol1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(trees, pgls_runA, <span class="at">model =</span> MuPGLSPol1, <span class="at">dataset =</span> PDVIS2)</span></code></pre></div>
<pre><code>## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dfPol1 <span class="ot">&lt;-</span> <span class="fu">ldply</span>(runsPol1, data.frame)</span></code></pre></div>
<p>Get results</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">HPDinterval</span>(<span class="fu">as.mcmc</span>(dfPol1))</span></code></pre></div>
<pre><code>##                lower      upper
## estimateP1 4.3130270 11.6583362
## ts1        0.4160769  1.2995120
## ps1        0.1740678  0.6345859
## attr(,&quot;Probability&quot;)
## [1] 0.9498978</code></pre>
</div>
</div>
</div>
<div id="ecology" class="section level2">
<h2>Ecology</h2>
<p><span style="color: #04C799"> <strong>Question</strong> </span>
<br/></p>
<p><strong>Is polarization correlated to the extracted climate
variables?</strong></p>
<div id="pgls-in-the-mcc" class="section level3">
<h3>PGLS in the MCC</h3>
<p>Create the data frame of comparative data</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>comp_data2 <span class="ot">&lt;-</span> <span class="fu">comparative.data</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">phy =</span> MCCtree,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> RPDAgg1, <span class="co"># aggregated data without the spp in the row names</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names.col =</span> <span class="st">&quot;phylogeny_name&quot;</span>, <span class="co"># contains the column phylogeny name</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">vcv =</span> <span class="cn">TRUE</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.omit =</span> <span class="cn">FALSE</span>, <span class="at">warn.dropped =</span> <span class="cn">TRUE</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(RPDAgg1<span class="sc">$</span>Pol)</span></code></pre></div>
<pre><code>## [1] 47</code></pre>
<p>Establish the model</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>pglsPDPol <span class="ot">&lt;-</span> <span class="fu">pgls</span>(Pol <span class="sc">~</span> PC1 <span class="sc">+</span> PC2 <span class="sc">+</span> size <span class="sc">+</span> PC1 <span class="sc">*</span> size <span class="sc">+</span> PC2 <span class="sc">*</span> size,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> comp_data2, <span class="at">param.CI =</span> <span class="fl">0.95</span>, <span class="at">lambda =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pglsPDPol)</span></code></pre></div>
<pre><code>## 
## Call:
## pgls(formula = Pol ~ PC1 + PC2 + size + PC1 * size + PC2 * size, 
##     data = comp_data2, lambda = &quot;ML&quot;, param.CI = 0.95)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.073277 -0.022585 -0.000383  0.021845  0.061326 
## 
## Branch length transformations:
## 
## kappa  [Fix]  : 1.000
## lambda [ ML]  : 0.906
##    lower bound : 0.000, p = 0.000010361
##    upper bound : 1.000, p = 0.0037362
##    95.0% CI   : (0.700, 0.983)
## delta  [Fix]  : 1.000
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)  0.0261496  0.1457823  0.1794   0.8585
## PC1         -0.0116126  0.0501381 -0.2316   0.8180
## PC2         -0.0880322  0.0656150 -1.3416   0.1871
## size         0.0124070  0.0508827  0.2438   0.8086
## PC1:size    -0.0043614  0.0217964 -0.2001   0.8424
## PC2:size     0.0295125  0.0265086  1.1133   0.2721
## 
## Residual standard error: 0.03623 on 41 degrees of freedom
## Multiple R-squared: 0.2541,  Adjusted R-squared: 0.1631 
## F-statistic: 2.794 on 5 and 41 DF,  p-value: 0.0292</code></pre>
<p>Polarization</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>pagelPDPol <span class="ot">&lt;-</span> PDVIS<span class="sc">$</span>Pol <span class="co"># Define which trait you want to test</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pagelPDPol) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(PDVIS) <span class="co"># Row names = tree tips</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">phylosig</span>(MCCtree, pagelPDPol, <span class="at">method =</span> <span class="st">&quot;lambda&quot;</span>, <span class="at">test =</span> <span class="cn">TRUE</span>, <span class="at">nsim =</span> <span class="dv">999</span>)</span></code></pre></div>
<pre><code>## 
## Phylogenetic signal lambda : 0.955169 
## logL(lambda) : 40.0202 
## LR(lambda=0) : 28.1436 
## P-value (based on LR test) : 0.000000112637</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nsim = 999 means testing with 999 randomizations</span></span></code></pre></div>
<p>Phylogenetic signal is high.</p>
<p><span style="color: #04C799"> <strong>Conclusion</strong> </span>
<br/></p>
<p><strong>Polarization does not directly correlate with these
ecological variables</strong></p>
<p><br> <br> <br></p>
</div>
<div id="pgls-in-multiple-trees" class="section level3">
<h3>PGLS in multiple trees</h3>
<p>Function</p>
<p>Note that the function has to be modified for the predictors and data
frame that we are using</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;7_multiple_pgls_function_B.R&quot;</span>) <span class="co"># script A is for Polarization as a response</span></span></code></pre></div>
<p>Model</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>MuPGLSPol2 <span class="ot">&lt;-</span> Polarization <span class="sc">~</span> PC1 <span class="sc">+</span> PC2 <span class="sc">+</span> size <span class="sc">+</span> PC1 <span class="sc">*</span> size <span class="sc">+</span> PC2 <span class="sc">*</span> size</span></code></pre></div>
<p>Dataset</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the phylogeny name again because in this function it is needed:</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>PDPol2 <span class="ot">&lt;-</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  PDPol <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">phylogeny_name =</span> <span class="fu">rownames</span>(PDPol)) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(phylogeny_name, Polarization, size, PC1, PC2)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>PDPol2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(PDPol2)</span></code></pre></div>
<p>Apply</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>runsPol2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(trees, pgls_runB, <span class="at">model =</span> MuPGLSPol2, <span class="at">dataset =</span> PDPol2)</span></code></pre></div>
<pre><code>## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH 
## ERROR : Problem with optim:52ERROR: ABNORMAL_TERMINATION_IN_LNSRCH</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>dfPol2 <span class="ot">&lt;-</span> <span class="fu">ldply</span>(runsPol2, data.frame)</span></code></pre></div>
<p>Get results</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">HPDinterval</span>(<span class="fu">as.mcmc</span>(dfPol2))</span></code></pre></div>
<pre><code>##                   lower        upper
## estimateP1 -0.025690717  0.008274889
## ts1        -0.509394426  0.155718334
## ps1         0.633248869  0.999820279
## estimateP2 -0.133125990 -0.057155922
## tP2        -2.005107771 -0.934519892
## pP2         0.032154158  0.307340151
## estimateP3 -0.001541629  0.045712709
## tP3        -0.045144640  0.841368889
## pP3         0.442754212  0.994823859
## estimateP4 -0.012606851  0.001696777
## tP4        -0.588644372  0.082999720
## pP4         0.613639989  0.999859216
## estimateP5  0.016492367  0.046320502
## tP5         0.662117534  1.725602999
## pP5         0.061421402  0.441443841
## attr(,&quot;Probability&quot;)
## [1] 0.949848</code></pre>
</div>
</div>
</div>
<div id="conclusions" class="section level1">
<h1>Conclusions</h1>
<ul>
<li>Polarization is indeed a well preserved character in this group of
beetles.</li>
<li>The degree of polarization does not correlate with any of the
studied ecological variables.</li>
<li>However, some beetles may use their chiral structures to reflect
more visible light. These beetles tend to have more polarization and
higher visible reflectivity.</li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
